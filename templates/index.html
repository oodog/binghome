<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Home Hub</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color:white; overflow:hidden; height:100vh; width:100vw;
        }
        /* Top Status Bar */
        .status-bar {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 8px 20px; display:flex; justify-content:space-between; align-items:center;
            height:60px; position:relative; z-index:100;
        }
        .status-left, .status-right { display:flex; align-items:center; gap:20px; }
        .sensor-item {
            display:flex; align-items:center; gap:8px;
            background: rgba(255,255,255,0.1);
            padding:4px 12px; border-radius:20px; font-size:14px;
        }
        .sensor-icon { width:16px; height:16px; opacity:.8; }
        .datetime { font-size:18px; font-weight:500; display:flex; gap:8px; align-items:center; }
        /* NEW: settings button */
        .settings-btn {
            display:inline-flex; align-items:center; gap:8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color:#fff; text-decoration:none; padding:8px 14px; border-radius:12px;
            transition: all .2s ease;
        }
        .settings-btn:hover { background: rgba(0,212,255,0.25); transform: translateY(-1px); }

        /* Main */
        .main-container { display:flex; height: calc(100vh - 60px - 60px); } /* minus status & nav */
        .news-sidebar {
            width:300px; background: rgba(0,0,0,0.2); backdrop-filter: blur(5px);
            border-right:1px solid rgba(255,255,255,0.1);
            padding:20px; overflow:hidden;
        }
        .news-title { font-size:18px; font-weight:600; margin-bottom:20px; color:#00d4ff; }
        .news-scroll { height: calc(100% - 60px); overflow:hidden; }
        .news-item{
            background: rgba(255,255,255,0.05); border-radius:10px; padding:15px; margin-bottom:15px;
            border-left:3px solid #00d4ff; transition:.3s ease; cursor:pointer;
        }
        .news-item:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .news-item h4 { font-size:14px; line-height:1.4; margin-bottom:5px; }
        .news-time { font-size:12px; opacity:.6; }

        .app-grid {
            flex:1; padding:40px;
            display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            grid-gap:30px; align-content:start;
        }
        .app-tile{
            background: rgba(255,255,255,0.08); border-radius:20px; padding:25px 15px;
            text-align:center; cursor:pointer; transition:.3s ease; backdrop-filter: blur(10px);
            border:1px solid rgba(255,255,255,0.1); position:relative; overflow:hidden; min-height:160px;
        }
        .app-tile:hover{ transform: translateY(-5px); background: rgba(255,255,255,0.15); box-shadow:0 20px 40px rgba(0,212,255,0.3); }
        .app-tile::before{
            content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition:left .5s;
        }
        .app-tile:hover::before{ left:100%; }

        .app-icon{
            width:60px; height:60px; margin:0 auto 15px; border-radius:12px;
            display:flex; align-items:center; justify-content:center; font-size:28px;
            background: linear-gradient(135deg, var(--icon-color-1), var(--icon-color-2));
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .app-title{ font-size:16px; font-weight:500; margin-bottom:5px; }
        .app-subtitle{ font-size:12px; opacity:.7; }

        /* App colors */
        .youtube{ --icon-color-1:#ff0000; --icon-color-2:#cc0000; }
        .netflix{ --icon-color-1:#e50914; --icon-color-2:#b20710; }
        .prime{ --icon-color-1:#00a8e1; --icon-color-2:#0073aa; }
        .xbox{ --icon-color-1:#107c10; --icon-color-2:#0e6b0e; }
        .settings{ --icon-color-1:#666; --icon-color-2:#444; }
        .assistant{ --icon-color-1:#00d4ff; --icon-color-2:#0099cc; }
        .home-assistant{ --icon-color-1:#41bdf5; --icon-color-2:#2196f3; }
        .music{ --icon-color-1:#1db954; --icon-color-2:#1aa34a; }

        /* Voice button */
        .voice-assistant{
            position:fixed; right:30px; bottom:90px; width:70px; height:70px; z-index:1000;
            background: linear-gradient(135deg, #00d4ff, #0099cc); border-radius:50%;
            display:flex; align-items:center; justify-content:center; cursor:pointer; transition:.3s ease;
            box-shadow: 0 10px 30px rgba(0,212,255,0.4);
        }
        .voice-assistant:hover{ transform: scale(1.07); box-shadow: 0 15px 40px rgba(0,212,255,0.6); }
        .voice-assistant.listening{ animation: pulse 1.5s infinite; }
        @keyframes pulse{ 0%{box-shadow:0 0 0 0 rgba(0,212,255,.7)} 70%{box-shadow:0 0 0 20px rgba(0,212,255,0)} 100%{box-shadow:0 0 0 0 rgba(0,212,255,0)} }

        /* Bottom nav */
        .nav-bar{
            position:fixed; left:0; right:0; bottom:0; z-index:1000;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            border-top:1px solid rgba(255,255,255,0.1);
            padding:10px 20px; display:flex; justify-content:center; gap:20px;
        }
        .nav-button{
            background: rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2);
            color:white; padding:12px 24px; border-radius:25px; cursor:pointer; transition:.2s;
            font-size:14px; display:flex; align-items:center; gap:8px;
        }
        .nav-button:hover{ background: rgba(0,212,255,0.8); transform: translateY(-2px); }
        .nav-button.active{ background: rgba(0,212,255,0.6); }

        /* Extra UI */
        .connection-status{ position:fixed; top:70px; right:20px; padding:8px 15px; border-radius:20px; font-size:12px; z-index:1001; transition:.3s }
        .connection-status.online{ background: rgba(68,255,68,.8); color:#000 }
        .connection-status.offline{ background: rgba(255,68,68,.8); color:#fff }
        .swipe-indicator{
            position:fixed; top:50%; left:20px; transform: translateY(-50%);
            background: rgba(0,212,255,.8); color:white; padding:10px 15px; border-radius:25px; font-size:14px;
            opacity:0; transition: opacity .3s ease; z-index:1001; pointer-events:none;
        }
        .swipe-indicator.show{ opacity:1; }

        /* Touch feedback */
        .app-tile:active{ transform: scale(.95); }
        @keyframes scroll{ 0%{transform: translateY(0)} 100%{transform: translateY(-100%)} }
        .auto-scroll{ animation: scroll 30s linear infinite; }

        /* Modal (kept from your version) */
        .modal{ display:none; position:fixed; inset:0; background: rgba(0,0,0,.8); backdrop-filter: blur(10px); z-index:2000; }
        .modal-content{
            position:absolute; top:50%; left:50%; transform: translate(-50%,-50%);
            background: rgba(20,20,40,.95); border-radius:20px; padding:40px; width:90%; max-width:800px;
            border:1px solid rgba(255,255,255,.2); max-height:90vh; overflow-y:auto;
        }
        .close{ position:absolute; top:15px; right:20px; font-size:30px; cursor:pointer; color:#666 }
        .close:hover{ color:#fff }
    </style>
</head>
<body>
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <div class="sensor-item"><span class="sensor-icon">üå°Ô∏è</span><span id="temperature">22.5¬∞C</span></div>
            <div class="sensor-item"><span class="sensor-icon">üíß</span><span id="humidity">45%</span></div>
            <div class="sensor-item"><span class="sensor-icon">üí®</span><span id="gas-status">Safe</span></div>
            <div class="sensor-item"><span class="sensor-icon">üí°</span><span id="light-level">Normal</span></div>
            <div class="sensor-item"><span class="sensor-icon">üîä</span><span id="audio-status">Active</span></div>
            <div class="sensor-item"><span class="sensor-icon">üì∂</span><span id="wifi-strength">85%</span></div>
        </div>
        <div class="status-right">
            <div class="datetime">
                <span id="current-time">14:30</span>
                <span id="current-date">Mon, Jul 21</span>
            </div>
            <!-- NEW: dedicated settings button -->
            <a class="settings-btn" href="/settings" title="Open Settings">‚öôÔ∏è Settings</a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- News Sidebar -->
        <div class="news-sidebar">
            <h3 class="news-title">Latest News</h3>
            <div class="news-scroll">
                <div id="news-container" class="auto-scroll">
                    <!-- fallback demo items; replaced by /api/news if you add it -->
                    <div class="news-item"><h4>Raspberry Pi launches new model A with enhanced AI capabilities</h4><div class="news-time">2 hours ago</div></div>
                    <div class="news-item"><h4>Global tech stocks soar in market rally following AI breakthrough</h4><div class="news-time">4 hours ago</div></div>
                    <div class="news-item"><h4>New breakthrough in quantum computing announced by major tech company</h4><div class="news-time">6 hours ago</div></div>
                    <div class="news-item"><h4>Smart home adoption reaches all-time high in 2025</h4><div class="news-time">8 hours ago</div></div>
                    <div class="news-item"><h4>Revolutionary battery technology promises 10x longer life</h4><div class="news-time">10 hours ago</div></div>
                </div>
            </div>
        </div>

        <!-- App Grid -->
        <div class="app-grid">
            <div class="app-tile youtube" onclick="openApp('youtube')"><div class="app-icon">üé•</div><div class="app-title">YouTube</div><div class="app-subtitle">Watch videos</div></div>
            <div class="app-tile netflix" onclick="openApp('netflix')"><div class="app-icon">üìΩÔ∏è</div><div class="app-title">Netflix</div><div class="app-subtitle">Stream movies</div></div>
            <div class="app-tile prime" onclick="openApp('prime')"><div class="app-icon">üì∫</div><div class="app-title">Prime Video</div><div class="app-subtitle">Amazon Prime</div></div>
            <div class="app-tile xbox" onclick="openApp('xbox')"><div class="app-icon">üéÆ</div><div class="app-title">Xbox Cloud</div><div class="app-subtitle">Cloud gaming</div></div>
            <div class="app-tile music" onclick="openApp('music')"><div class="app-icon">üéµ</div><div class="app-title">Spotify</div><div class="app-subtitle">Music streaming</div></div>
            <div class="app-tile home-assistant" onclick="openApp('home-assistant')"><div class="app-icon">üè†</div><div class="app-title">Home Assistant</div><div class="app-subtitle">Smart home control</div></div>
            <div class="app-tile assistant" onclick="openApp('assistant')"><div class="app-icon">ü§ñ</div><div class="app-title">AI Assistant</div><div class="app-subtitle">ChatGPT powered</div></div>
            <div class="app-tile settings" onclick="openSettings()"><div class="app-icon">‚öôÔ∏è</div><div class="app-title">Settings</div><div class="app-subtitle">System config</div></div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status online" id="connection-status">Online</div>

    <!-- Bottom Navigation -->
    <div class="nav-bar">
        <button class="nav-button active" onclick="showHome()" id="home-btn">üè† Home</button>
        <button class="nav-button" onclick="showSettings()" id="settings-btn">‚öôÔ∏è Settings</button>
        <button class="nav-button" onclick="showAssistant()" id="assistant-btn">ü§ñ Assistant</button>
        <button class="nav-button" onclick="goBack()" id="back-btn-nav">‚¨ÖÔ∏è Back</button>
    </div>

    <!-- Swipe Indicator -->
    <div class="swipe-indicator" id="swipe-indicator">Swipe right to go back</div>

    <!-- Voice Assistant Button (push to talk toggle) -->
    <div class="voice-assistant" onclick="toggleVoiceAssistant()" id="voice-btn" title="Tap to speak / stop">
        <span style="font-size:30px;">üé§</span>
    </div>

    <!-- Settings Modal (your existing modal kept) -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSettings()">&times;</span>
            <h2 style="margin-bottom: 30px; color: #00d4ff;">‚öôÔ∏è System Settings</h2>
            <!-- keep your existing sections here ... -->
            <p style="opacity:.75">For full settings, use the top-right <b>Settings</b> button (opens /settings).</p>
        </div>
    </div>

    <script>
        /* ---------------- Date/Time ---------------- */
        function updateDateTime() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: false };
            const dateOptions = { weekday: 'short', month: 'short', day: 'numeric' };
            document.getElementById('current-time').textContent = now.toLocaleTimeString(undefined, timeOptions);
            document.getElementById('current-date').textContent = now.toLocaleDateString(undefined, dateOptions);
        }

        /* ---------------- Sensors ---------------- */
        function updateSensorData() {
            fetch('/api/sensor_data')
                .then(r => r.ok ? r.json() : Promise.reject(r.status))
                .then(data => {
                    if ('temperature' in data) document.getElementById('temperature').textContent = (data.temperature ?? '--') + '¬∞C';
                    if ('humidity' in data) document.getElementById('humidity').textContent = (data.humidity ?? '--') + '%';
                    if ('gas_detected' in data) document.getElementById('gas-status').textContent = data.gas_detected ? 'Alert' : 'Safe';
                    if ('light_detected' in data) document.getElementById('light-level').textContent = data.light_detected ? 'Bright' : 'Normal';
                })
                .catch(() => {});
        }

        /* ---------------- News (optional /api/news) ---------------- */
        function updateNews() {
            fetch('/api/news')
                .then(r => r.ok ? r.json() : Promise.reject())
                .then(items => {
                    if (!Array.isArray(items)) return;
                    const container = document.getElementById('news-container');
                    container.innerHTML = '';
                    items.forEach(it => {
                        const el = document.createElement('div');
                        el.className = 'news-item';
                        el.innerHTML = `<h4>${it.title}</h4><div class="news-time">${it.time || ''}</div>`;
                        container.appendChild(el);
                    });
                }).catch(()=>{});
        }

        /* ---------------- Apps ---------------- */
        function openApp(name){
            const urls = {
                youtube:'https://youtube.com',
                netflix:'https://netflix.com',
                prime:'https://primevideo.com',
                xbox:'https://xbox.com/play',
                music:'https://open.spotify.com',
                'home-assistant':'http://localhost:8123',
                assistant:'/assistant'
            };
            if (urls[name]) window.open(urls[name], '_blank');
        }
        function openSettings(){ document.getElementById('settings-modal').style.display='block'; }
        function closeSettings(){ document.getElementById('settings-modal').style.display='none'; }
        function showHome(){ window.location.href = '/'; }
        function showSettings(){ window.location.href = '/settings'; }
        function showAssistant(){ window.location.href = '/assistant'; } // add this route later if you want
        function goBack(){ history.back(); }

        /* ---------------- Connection badge ---------------- */
        function updateOnline(){
            const el = document.getElementById('connection-status');
            const on = navigator.onLine;
            el.textContent = on ? 'Online' : 'Offline';
            el.className = 'connection-status ' + (on ? 'online':'offline');
        }
        window.addEventListener('online', updateOnline);
        window.addEventListener('offline', updateOnline);

        /* ---------------- Voice: Home/Settings shortcuts ---------------- */
        let recognizing = false, recognition;
        function supportsWebSpeech(){
            return 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
        }
        function ensureRecognizer(){
            if (!supportsWebSpeech()) return null;
            const Ctor = window.SpeechRecognition || window.webkitSpeechRecognition;
            const rec = new Ctor();
            rec.lang = 'en-US';
            rec.interimResults = false;
            rec.continuous = false;
            return rec;
        }
        function toggleVoiceAssistant(){
            const btn = document.getElementById('voice-btn');
            if (recognizing){ recognition.stop(); recognizing=false; btn.classList.remove('listening'); return; }
            recognition = ensureRecognizer();
            if (recognition){
                recognition.onstart = ()=>{ recognizing=true; btn.classList.add('listening'); };
                recognition.onend = ()=>{ recognizing=false; btn.classList.remove('listening'); };
                recognition.onerror = ()=>{ recognizing=false; btn.classList.remove('listening'); };
                recognition.onresult = (ev)=>{
                    const text = (ev.results[0] && ev.results[0][0] && ev.results[0][0].transcript || '').toLowerCase().trim();
                    handleLocalVoice(text);
                };
                recognition.start();
            } else {
                // fallback: if no Web Speech, click toggles nothing. (Server-side push-to-talk can be wired here)
                alert('Voice recognition not supported on this browser.');
            }
        }
        function handleLocalVoice(text){
            if (!text) return;
            // go home / settings quick intents
            if (/(^|\s)(home|go home|back to home|main screen)($|\s)/i.test(text)) { showHome(); return; }
            if (/(settings|open settings|system settings)/i.test(text)) { showSettings(); return; }
            if (/(back|go back|previous)/i.test(text)) { goBack(); return; }
            // Otherwise let backend handle (lights, scenes, etc.) if you want:
            fetch('/api/voice', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({text})})
                .then(r=>r.json()).then(j=>{ if(!j.success && j.error){ console.log(j.error); } });
        }

        /* ---------------- Gestures: pinch-in to HOME ---------------- */
        let pinchStartDist = null;
        function touchDistance(t1,t2){
            const dx = t1.clientX - t2.clientX, dy = t1.clientY - t2.clientY;
            return Math.hypot(dx, dy);
        }
        window.addEventListener('touchstart', (e)=>{
            if (e.touches.length===2){
                pinchStartDist = touchDistance(e.touches[0], e.touches[1]);
            }
        }, {passive:true});
        window.addEventListener('touchmove', (e)=>{
            if (e.touches.length===2 && pinchStartDist){
                const dist = touchDistance(e.touches[0], e.touches[1]);
                // if user pinches in by >20% of start distance -> go home
                if (dist < pinchStartDist * 0.8){
                    pinchStartDist = null;
                    showHome();
                }
            }
        }, {passive:true});
        window.addEventListener('touchend', ()=>{ if (event.touches && event.touches.length<2) pinchStartDist=null; }, {passive:true});

        /* ---------------- Init ---------------- */
        function safe(fn){ try{ fn(); }catch(e){} }
        safe(updateOnline); safe(updateDateTime); safe(updateSensorData); safe(updateNews);
        setInterval(()=>safe(updateDateTime), 60000);
        setInterval(()=>safe(updateSensorData), 30000);
        setInterval(()=>safe(updateNews), 300000);

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('settings-modal');
            if (event.target === modal) modal.style.display = 'none';
        }
    </script>
</body>
</html>
