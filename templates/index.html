<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BingHome Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tile: #141414;
            --accent: #00ff88;
            --accent-dim: #00cc66;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --border: rgba(255, 255, 255, 0.08);
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top Bar */
        .top-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
            flex-shrink: 0;
        }

        .network-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .network-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--glass);
            border-radius: 15px;
            font-size: 13px;
        }

        .network-icon {
            width: 16px;
            height: 16px;
        }

        .sensor-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sensor-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }

        .sensor-value {
            color: var(--accent);
            font-weight: 600;
        }

        /* Main Layout */
        .main-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 2px;
            background: var(--bg-secondary);
            overflow: hidden;
        }

        /* Widget Tiles */
        .widget-tile {
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .widget-tile:hover {
            transform: scale(1.02);
            z-index: 10;
        }

        /* Google Photos Widget */
        .photos-widget {
            grid-row: 1;
            grid-column: 1;
            padding: 15px;
        }

        .photos-frame {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
            background: #000;
        }

        .photos-slideshow {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 10px;
        }

        /* Weather Widget */
        .weather-widget {
            grid-row: 1;
            grid-column: 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .weather-current {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .weather-temp {
            font-size: 48px;
            font-weight: 300;
            color: var(--accent);
        }

        .weather-condition {
            text-align: right;
        }

        .weather-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .weather-desc {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .weather-forecast {
            display: flex;
            gap: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .forecast-day {
            flex: 1;
            text-align: center;
        }

        .forecast-day-name {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .forecast-temp {
            font-size: 14px;
        }

        /* Apps Widget */
        .apps-widget {
            grid-row: 2;
            grid-column: span 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            flex: 1;
            align-content: center;
        }

        .app-tile {
            aspect-ratio: 1;
            background: var(--bg-tile);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .app-tile:hover {
            background: var(--glass);
            border-color: var(--accent);
            transform: translateY(-5px);
        }

        .app-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .app-name {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Voice Assistant Overlay */
        .voice-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .voice-overlay.active {
            display: flex;
        }

        .voice-container {
            text-align: center;
        }

        .voice-animation {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            background: radial-gradient(circle, var(--accent), transparent);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        .voice-text {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .voice-command {
            font-size: 18px;
            color: var(--accent);
            margin-top: 20px;
            min-height: 30px;
        }

        /* App Frame */
        .app-frame {
            position: fixed;
            top: 50px;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            display: none;
            z-index: 500;
        }

        .app-frame.active {
            display: block;
        }

        .app-frame iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .app-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        .app-control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .app-control-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
        }

        /* Settings Button */
        .settings-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-tile);
            border: 2px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .settings-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            transform: rotate(90deg);
        }

        /* Radar View */
        .weather-radar {
            display: none;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            overflow: hidden;
        }

        .weather-radar.active {
            display: block;
        }

        .weather-main {
            display: block;
        }

        .weather-main.hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(3, 1fr);
            }

            .apps-widget {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="network-status">
            <div class="network-item" id="ethernetStatus" style="display: none;">
                <svg class="network-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M7.77 6.76L6.23 5.48.82 12l5.41 6.52 1.54-1.28L3.42 12l4.35-5.24zM7 13h2v-2H7v2zm10-2h-2v2h2v-2zm-6 2h2v-2h-2v2zm6.77-7.52l-1.54 1.28L20.58 12l-4.35 5.24 1.54 1.28L23.18 12l-5.41-6.52z"/>
                </svg>
                <span>Ethernet</span>
            </div>
            <div class="network-item" id="wifiStatus" style="display: none;">
                <svg class="network-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/>
                </svg>
                <span id="wifiName">WiFi</span>
                <span id="wifiSignal"></span>
            </div>
        </div>
        
        <div class="sensor-status">
            <div class="sensor-item">
                <span>üå°Ô∏è</span>
                <span class="sensor-value" id="tempValue">--</span>
                <span>¬∞C</span>
            </div>
            <div class="sensor-item">
                <span>üíß</span>
                <span class="sensor-value" id="humidityValue">--</span>
                <span>%</span>
            </div>
            <div class="sensor-item">
                <span>üå¨Ô∏è</span>
                <span class="sensor-value" id="airQuality">Good</span>
            </div>
            <div class="sensor-item">
                <span>üí°</span>
                <span class="sensor-value" id="lightLevel">Bright</span>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Google Photos Widget -->
        <div class="widget-tile photos-widget">
            <div class="photos-slideshow" id="photosWidget">
                <iframe 
                    class="photos-frame"
                    id="photosFrame"
                    src=""
                    title="Google Photos"
                    style="display: none;">
                </iframe>
                <div id="photosPlaceholder">
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üì∑</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">Google Photos</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">Click to connect</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Widget -->
        <div class="widget-tile weather-widget" onclick="toggleWeatherView()">
            <div class="weather-main" id="weatherMain">
                <div class="weather-current">
                    <div>
                        <div class="weather-temp" id="weatherTemp">--¬∞</div>
                        <div class="weather-location" id="weatherLocation">Loading...</div>
                    </div>
                    <div class="weather-condition">
                        <div class="weather-icon" id="weatherIcon">‚òÄÔ∏è</div>
                        <div class="weather-desc" id="weatherDesc">--</div>
                    </div>
                </div>
                <div class="weather-forecast" id="weatherForecast">
                    <!-- Forecast will be added dynamically -->
                </div>
            </div>
            <div class="weather-radar" id="weatherRadar">
                <iframe 
                    src=""
                    id="radarFrame"
                    style="width: 100%; height: 100%; border: none;"
                    title="Weather Radar">
                </iframe>
            </div>
        </div>

        <!-- Apps Widget -->
        <div class="widget-tile apps-widget">
            <div class="apps-grid">
                <div class="app-tile" onclick="launchApp('netflix')">
                    <div class="app-icon">üé¨</div>
                    <div class="app-name">Netflix</div>
                </div>
                <div class="app-tile" onclick="launchApp('prime_video')">
                    <div class="app-icon">üì∫</div>
                    <div class="app-name">Prime Video</div>
                </div>
                <div class="app-tile" onclick="launchApp('youtube')">
                    <div class="app-icon">‚ñ∂Ô∏è</div>
                    <div class="app-name">YouTube</div>
                </div>
                <div class="app-tile" onclick="launchApp('xbox_cloud')">
                    <div class="app-icon">üéÆ</div>
                    <div class="app-name">Xbox Cloud</div>
                </div>
                <div class="app-tile" onclick="launchApp('spotify')">
                    <div class="app-icon">üéµ</div>
                    <div class="app-name">Spotify</div>
                </div>
                <div class="app-tile" onclick="openDevices()">
                    <div class="app-icon">üè†</div>
                    <div class="app-name">Devices</div>
                </div>
                <div class="app-tile" onclick="openTimers()">
                    <div class="app-icon">‚è∞</div>
                    <div class="app-name">Timers</div>
                </div>
                <div class="app-tile" onclick="openNews()">
                    <div class="app-icon">üì∞</div>
                    <div class="app-name">News</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Assistant Overlay -->
    <div class="voice-overlay" id="voiceOverlay">
        <div class="voice-container">
            <div class="voice-animation"></div>
            <div class="voice-text" id="voiceStatus">Listening...</div>
            <div class="voice-command" id="voiceCommand"></div>
        </div>
    </div>

    <!-- App Frame -->
    <div class="app-frame" id="appFrame">
        <iframe id="appIframe" src=""></iframe>
        <div class="app-controls">
            <button class="app-control-btn" onclick="closeApp()">‚úï</button>
        </div>
    </div>

    <!-- Settings Button -->
    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        // Global variables
        const socket = io();
        let settings = {};
        let recognition = null;
        let weatherView = 'current';
        let photosConnected = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeHub();
            setupVoiceRecognition();
            startDataUpdates();
        });

        function initializeHub() {
            // Load settings
            fetch('/api/settings')
                .then(response => response.json())
                .then(data => {
                    settings = data;
                    updatePhotosWidget();
                });

            // Update weather
            updateWeather();
            
            // Update network status
            updateNetworkStatus();
        }

        // Socket handlers
        socket.on('connect', function() {
            console.log('Connected to BingHome Hub');
        });

        socket.on('sensor_update', function(data) {
            document.getElementById('tempValue').textContent = 
                data.temperature ? data.temperature.toFixed(1) : '--';
            document.getElementById('humidityValue').textContent = 
                data.humidity ? data.humidity.toFixed(1) : '--';
            document.getElementById('airQuality').textContent = 
                data.air_quality || 'Unknown';
            document.getElementById('lightLevel').textContent = 
                data.light_level ? data.light_level.charAt(0).toUpperCase() + data.light_level.slice(1) : 'Unknown';
        });

        socket.on('network_update', function(data) {
            updateNetworkDisplay(data);
        });

        socket.on('wake_word_detected', function() {
            showVoiceOverlay();
        });

        socket.on('voice_response', function(data) {
            if (data.command) {
                document.getElementById('voiceCommand').textContent = 
                    `"${data.command}"`;
            }
            if (data.response) {
                document.getElementById('voiceStatus').textContent = data.response;
            }
            setTimeout(hideVoiceOverlay, 3000);
        });

        socket.on('app_launched', function(data) {
            const iframe = document.getElementById('appIframe');
            iframe.src = data.url;
            document.getElementById('appFrame').classList.add('active');
        });

        // Voice Recognition
        function setupVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                recognition.onresult = function(event) {
                    const last = event.results.length - 1;
                    const command = event.results[last][0].transcript.toLowerCase();
                    
                    // Check for wake word
                    const wakeWords = settings.wake_words || ['hey bing', 'okay bing'];
                    for (let wake of wakeWords) {
                        if (command.includes(wake)) {
                            showVoiceOverlay();
                            const actualCommand = command.replace(wake, '').trim();
                            if (actualCommand) {
                                processVoiceCommand(actualCommand);
                            }
                            break;
                        }
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Voice recognition error:', event.error);
                };

                // Start recognition
                try {
                    recognition.start();
                } catch (e) {
                    console.log('Voice recognition already started');
                }
            }
        }

        function showVoiceOverlay() {
            document.getElementById('voiceOverlay').classList.add('active');
            document.getElementById('voiceStatus').textContent = 'Listening...';
            document.getElementById('voiceCommand').textContent = '';
        }

        function hideVoiceOverlay() {
            document.getElementById('voiceOverlay').classList.remove('active');
        }

        function processVoiceCommand(command) {
            document.getElementById('voiceCommand').textContent = `"${command}"`;
            
            socket.emit('voice_command', {
                command: command
            });
        }

        // Network Status
        function updateNetworkStatus() {
            fetch('/api/network_status')
                .then(response => response.json())
                .then(data => updateNetworkDisplay(data))
                .catch(error => console.error('Network status error:', error));
        }

        function updateNetworkDisplay(data) {
            const ethernetEl = document.getElementById('ethernetStatus');
            const wifiEl = document.getElementById('wifiStatus');
            
            if (data.ethernet && data.ethernet.connected) {
                ethernetEl.style.display = 'flex';
                wifiEl.style.display = 'none';
            } else if (data.wifi && data.wifi.connected) {
                wifiEl.style.display = 'flex';
                ethernetEl.style.display = 'none';
                document.getElementById('wifiName').textContent = data.wifi.ssid || 'WiFi';
                if (data.wifi.signal) {
                    document.getElementById('wifiSignal').textContent = `${data.wifi.signal}%`;
                }
            } else {
                wifiEl.style.display = 'flex';
                ethernetEl.style.display = 'none';
                document.getElementById('wifiName').textContent = 'No Connection';
            }
        }

        // Weather
        function updateWeather() {
            fetch('/api/weather')
                .then(response => response.json())
                .then(data => {
                    if (data.current) {
                        document.getElementById('weatherTemp').textContent = `${data.current.temp}¬∞`;
                        document.getElementById('weatherDesc').textContent = data.current.description || '--';
                        document.getElementById('weatherLocation').textContent = data.current.location || 'Your Location';
                        
                        // Update icon based on condition
                        const iconMap = {
                            'Clear': '‚òÄÔ∏è',
                            'Clouds': '‚òÅÔ∏è',
                            'Rain': 'üåßÔ∏è',
                            'Snow': '‚ùÑÔ∏è',
                            'Thunderstorm': '‚õàÔ∏è',
                            'Drizzle': 'üå¶Ô∏è',
                            'Mist': 'üå´Ô∏è'
                        };
                        document.getElementById('weatherIcon').textContent = 
                            iconMap[data.current.condition] || 'üå§Ô∏è';
                    }
                    
                    if (data.forecast && data.forecast.length > 0) {
                        const forecastEl = document.getElementById('weatherForecast');
                        forecastEl.innerHTML = data.forecast.slice(0, 4).map(day => `
                            <div class="forecast-day">
                                <div class="forecast-day-name">${new Date(day.date).toLocaleDateString('en', {weekday: 'short'})}</div>
                                <div class="forecast-temp">${day.temp_min}¬∞/${day.temp_max}¬∞</div>
                            </div>
                        `).join('');
                    }
                })
                .catch(error => console.error('Weather error:', error));
        }

        function toggleWeatherView() {
            const mainView = document.getElementById('weatherMain');
            const radarView = document.getElementById('weatherRadar');
            
            if (weatherView === 'current') {
                mainView.classList.add('hidden');
                radarView.classList.add('active');
                
                // Load radar if not loaded
                const radarFrame = document.getElementById('radarFrame');
                if (!radarFrame.src) {
                    // Use a weather radar service URL for your location
                    radarFrame.src = 'https://www.rainviewer.com/map.html';
                }
                weatherView = 'radar';
            } else {
                mainView.classList.remove('hidden');
                radarView.classList.remove('active');
                weatherView = 'current';
            }
        }

        // Google Photos
        function updatePhotosWidget() {
            const photosFrame = document.getElementById('photosFrame');
            const placeholder = document.getElementById('photosPlaceholder');
            
            if (settings.apps && settings.apps.google_photos && settings.apps.google_photos.enabled) {
                photosFrame.src = settings.apps.google_photos.url;
                photosFrame.style.display = 'block';
                placeholder.style.display = 'none';
                photosConnected = true;
            }
        }

        // App Launcher
        function launchApp(appName) {
            if (settings.apps && settings.apps[appName]) {
                const appFrame = document.getElementById('appFrame');
                const iframe = document.getElementById('appIframe');
                iframe.src = settings.apps[appName].url;
                appFrame.classList.add('active');
            }
        }

        function closeApp() {
            const appFrame = document.getElementById('appFrame');
            const iframe = document.getElementById('appIframe');
            appFrame.classList.remove('active');
            setTimeout(() => {
                iframe.src = '';
            }, 300);
        }

        function openSettings() {
            window.location.href = '/settings';
        }

        function openDevices() {
            // Open devices management
            console.log('Opening devices');
        }

        function openTimers() {
            // Open timers interface
            console.log('Opening timers');
        }

        function openNews() {
            // Open news feed
            console.log('Opening news');
        }

        // Auto-refresh
        function startDataUpdates() {
            // Update sensors every 5 seconds
            setInterval(() => {
                socket.emit('request_sensor_data');
            }, 5000);
            
            // Update weather every 10 minutes
            setInterval(updateWeather, 600000);
            
            // Update network status every 30 seconds
            setInterval(updateNetworkStatus, 30000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeApp();
                hideVoiceOverlay();
            }
        });
    </script>
</body>
</html>
