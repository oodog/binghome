<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wi-Fi</title>
<style>
  body{font-family:Segoe UI,Arial;background:#111;color:#fff;margin:0}
  .wrap{max-width:900px;margin:0 auto;padding:20px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:16px;margin:10px 0}
  .btn{background:#0078d7;border:none;color:#fff;padding:10px 16px;border-radius:10px;cursor:pointer}
  input{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff}
  ul{list-style:none;padding:0}
  li{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.1);display:flex;justify-content:space-between;align-items:center}
  a{color:#0df;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="row" style="justify-content:space-between">
    <h2>Wi-Fi</h2>
    <div><a class="btn" href="/">Home</a></div>
  </div>

  <div class="card">
    <div class="row">
      <button class="btn" onclick="scan()">Scan</button>
      <span id="scanOut" style="opacity:.8"></span>
    </div>
    <ul id="nets"></ul>
  </div>

  <div class="card">
    <h3>Join Network</h3>
    <div class="row">
      <input id="ssid" placeholder="SSID">
      <input id="pass" placeholder="Password (if any)" type="password">
      <button class="btn" onclick="join()">Connect</button>
    </div>
    <div id="joinOut" style="margin-top:8px;opacity:.85"></div>
  </div>
</div>

<script>
async function scan(){
  const s = document.getElementById('scanOut');
  const list = document.getElementById('nets');
  s.textContent='Scanning…'; list.innerHTML='';
  try{
    const r = await fetch('/api/wifi_scan');
    const j = await r.json();
    const nets = j.networks || [];
    s.textContent = nets.length ? `${nets.length} networks` : 'No networks found.';
    nets.forEach(n=>{
      const li = document.createElement('li');
      li.innerHTML = `<span>${n}</span> <button class="btn" onclick="fillAndJoin('${n}')">Join</button>`;
      list.appendChild(li);
    });
  }catch(e){
    s.textContent='Scan failed.';
  }
}
function fillAndJoin(ssid){
  document.getElementById('ssid').value = ssid;
  document.getElementById('pass').focus();
}
async function join(){
  const ssid = document.getElementById('ssid').value.trim();
  const password = document.getElementById('pass').value;
  const out = document.getElementById('joinOut');
  if(!ssid){ out.textContent='SSID required.'; return; }
  out.textContent='Connecting…';
  try{
    const r = await fetch('/api/wifi_connect', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ssid, password})});
    const j = await r.json();
    out.textContent = j.success ? 'Connected (or attempting)…' : ('Failed: ' + (j.info || j.error || 'unknown'));
  }catch(e){
    out.textContent='Connect failed.';
  }
}
</script>
</body>
</html>
